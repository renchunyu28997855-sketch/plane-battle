var p=Object.defineProperty;var w=(o,t,e)=>t in o?p(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>w(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const n of h.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=e(i);fetch(i.href,h)}})();const v={canvasWidth:480,canvasHeight:720,fps:60,playerSpeed:5,bulletSpeed:8,enemyBaseSpeed:2,spawnInterval:1500,bulletDamage:1,playerHealth:3},c=[{level:1,name:"ç¬¬ä¸€å…³",enemyCount:20,spawnInterval:1500,enemySpeed:2,bossLevel:!1},{level:2,name:"ç¬¬äºŒå…³",enemyCount:30,spawnInterval:1200,enemySpeed:3,bossLevel:!1},{level:3,name:"ç¬¬ä¸‰å…³",enemyCount:30,spawnInterval:1e3,enemySpeed:4,bossLevel:!0}];function d(o,t){return o.x<t.x+t.width&&o.x+o.width>t.x&&o.y<t.y+t.height&&o.y+o.height>t.y}function u(o,t,e){return Math.max(t,Math.min(e,o))}function g(o,t){return Math.floor(Math.random()*(t-o+1))+o}class x{constructor(){a(this,"audioContext",null);a(this,"masterGain",null);a(this,"enabled",!0);a(this,"volume",.3);this.initAudio()}initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=this.volume}catch{console.warn("Web Audio API not supported")}}async unlock(){var t;((t=this.audioContext)==null?void 0:t.state)==="suspended"&&await this.audioContext.resume()}setEnabled(t){this.enabled=t}setVolume(t){this.volume=Math.max(0,Math.min(1,t)),this.masterGain&&(this.masterGain.gain.value=this.volume)}play(t){if(!(!this.enabled||!this.audioContext||!this.masterGain))switch(this.unlock(),t){case"shoot":this.playShoot();break;case"enemyShoot":this.playEnemyShoot();break;case"explosion":this.playExplosion();break;case"powerUp":this.playPowerUp();break;case"hit":this.playHit();break;case"gameOver":this.playGameOver();break;case"levelUp":this.playLevelUp();break}}playShoot(){if(!this.audioContext||!this.masterGain)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.masterGain),t.type="square",t.frequency.setValueAtTime(880,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(220,this.audioContext.currentTime+.1),e.gain.setValueAtTime(.3,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.1)}playEnemyShoot(){if(!this.audioContext||!this.masterGain)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.masterGain),t.type="sawtooth",t.frequency.setValueAtTime(220,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(110,this.audioContext.currentTime+.15),e.gain.setValueAtTime(.2,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.15)}playExplosion(){if(!this.audioContext||!this.masterGain)return;const t=this.audioContext.sampleRate*.3,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),s=e.getChannelData(0);for(let l=0;l<t;l++)s[l]=Math.random()*2-1;const i=this.audioContext.createBufferSource();i.buffer=e;const h=this.audioContext.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(1e3,this.audioContext.currentTime),h.frequency.exponentialRampToValueAtTime(100,this.audioContext.currentTime+.3);const n=this.audioContext.createGain();n.gain.setValueAtTime(.5,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),i.connect(h),h.connect(n),n.connect(this.masterGain),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+.3)}playPowerUp(){if(!this.audioContext||!this.masterGain)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createOscillator(),s=this.audioContext.createGain();t.connect(s),e.connect(s),s.connect(this.masterGain),t.type="sine",e.type="sine",t.frequency.setValueAtTime(523,this.audioContext.currentTime),t.frequency.setValueAtTime(659,this.audioContext.currentTime+.1),t.frequency.setValueAtTime(784,this.audioContext.currentTime+.2),e.frequency.setValueAtTime(523*1.5,this.audioContext.currentTime),e.frequency.setValueAtTime(659*1.5,this.audioContext.currentTime+.1),e.frequency.setValueAtTime(784*1.5,this.audioContext.currentTime+.2),s.gain.setValueAtTime(.2,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.4),t.start(this.audioContext.currentTime),e.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.4),e.stop(this.audioContext.currentTime+.4)}playHit(){if(!this.audioContext||!this.masterGain)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.masterGain),t.type="triangle",t.frequency.setValueAtTime(150,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.05),e.gain.setValueAtTime(.3,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.05),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.05)}playGameOver(){if(!this.audioContext||!this.masterGain)return;const t=[392,370,330,262],e=.2;t.forEach((s,i)=>{const h=this.audioContext.createOscillator(),n=this.audioContext.createGain();h.connect(n),n.connect(this.masterGain),h.type="sine",h.frequency.value=s;const l=this.audioContext.currentTime+i*e;n.gain.setValueAtTime(.3,l),n.gain.exponentialRampToValueAtTime(.01,l+e),h.start(l),h.stop(l+e)})}playLevelUp(){if(!this.audioContext||!this.masterGain)return;const t=[523,659,784,1047],e=.15;t.forEach((s,i)=>{const h=this.audioContext.createOscillator(),n=this.audioContext.createGain();h.connect(n),n.connect(this.masterGain),h.type="square",h.frequency.value=s;const l=this.audioContext.currentTime+i*e;n.gain.setValueAtTime(.2,l),n.gain.exponentialRampToValueAtTime(.01,l+e),h.start(l),h.stop(l+e)})}destroy(){this.audioContext&&this.audioContext.close()}}const y=new x;class T{constructor(t,e,s){a(this,"x");a(this,"y");a(this,"width",40);a(this,"height",50);a(this,"health",3);a(this,"maxHealth",3);a(this,"shootCooldown",0);a(this,"shootInterval",200);this.x=t,this.y=e,this.maxHealth=s.playerHealth,this.health=s.playerHealth}reset(t,e){this.x=t,this.y=e,this.health=this.maxHealth,this.shootCooldown=0}shoot(t){this.shootCooldown<=0&&(t.createPlayerBullet(this.x,this.y-this.height/2),this.shootCooldown=this.shootInterval,y.play("shoot"))}update(t){this.shootCooldown>0&&(this.shootCooldown-=t)}takeDamage(t){this.health-=t,this.health<0&&(this.health=0)}isDestroyed(){return this.health<=0}getRect(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}checkCollision(t){return d(this.getRect(),t.getRect())}render(t){this.drawBody(t),this.drawHealthIndicator(t)}drawBody(t){t.fillStyle="#3498db",t.beginPath(),t.moveTo(this.x,this.y-this.height/2),t.lineTo(this.x-this.width/2,this.y+this.height/2),t.lineTo(this.x+this.width/2,this.y+this.height/2),t.closePath(),t.fill(),t.fillStyle="#2980b9",t.beginPath(),t.ellipse(this.x,this.y-5,8,12,0,0,Math.PI*2),t.fill(),Math.random()>.5&&(t.fillStyle="#e74c3c",t.beginPath(),t.moveTo(this.x-5,this.y+this.height/2),t.lineTo(this.x,this.y+this.height/2+15),t.lineTo(this.x+5,this.y+this.height/2),t.closePath(),t.fill())}drawHealthIndicator(t){const i=this.x-15,h=this.y+this.height/2+10;t.fillStyle="#555555",t.fillRect(i,h,30,4);const n=this.health/this.maxHealth;t.fillStyle=n>.3?"#2ecc71":"#e74c3c",t.fillRect(i,h,30*n,4)}}class r{constructor(t,e,s,i,h,n="normal"){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"speed");a(this,"vx",0);a(this,"damage");a(this,"active",!0);a(this,"isPlayer");a(this,"type");a(this,"targetX",null);this.x=t,this.y=e,this.speed=s,this.damage=i,this.isPlayer=h,this.type=n,n==="laser"?(this.width=6,this.height=40):n==="spread"?(this.width=4,this.height=10):(this.width=4,this.height=12)}setTarget(t){this.targetX=t}update(t){const e=this.isPlayer?-1:1,s=t/16;if(this.type==="tracking"&&this.targetX!==null){const i=this.targetX-this.x;this.vx=i*.02,this.y+=this.speed*e*s,this.x+=this.vx*s}else this.type==="spread"?(this.y+=this.speed*e*s,this.x+=this.vx*s):this.type==="laser"?this.y+=this.speed*1.5*e*s:this.y+=this.speed*e*s}isOutOfBounds(t){return this.y<-this.height||this.y>t+this.height}getRect(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}checkCollision(t){return d(this.getRect(),t.getRect())}render(t){if(this.active)if(this.type==="laser"){const e=t.createLinearGradient(this.x,this.y-this.height/2,this.x,this.y+this.height/2);e.addColorStop(0,"rgba(0, 255, 255, 0.8)"),e.addColorStop(.5,"rgba(0, 255, 255, 1)"),e.addColorStop(1,"rgba(0, 255, 255, 0.3)"),t.fillStyle=e,t.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),t.shadowBlur=10,t.shadowColor="#00ffff",t.fillRect(this.x-2,this.y-this.height/2,4,this.height),t.shadowBlur=0}else this.type==="tracking"?(t.fillStyle="#00ffff",t.beginPath(),t.arc(this.x,this.y,this.width,0,Math.PI*2),t.fill(),t.fillStyle="rgba(0, 255, 255, 0.5)",t.fillRect(this.x-1,this.y+this.height/2,2,8)):this.type==="spread"?(t.fillStyle="#9b59b6",t.beginPath(),t.arc(this.x,this.y,this.width+1,0,Math.PI*2),t.fill()):(t.fillStyle=this.isPlayer?"#f1c40f":"#e74c3c",t.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height))}}class b{constructor(t){a(this,"bullets",[]);a(this,"config");this.config=t}createPlayerBullet(t,e){const s=new r(t,e,this.config.bulletSpeed,this.config.bulletDamage,!0);this.bullets.push(s)}createEnemyBullet(t,e){const s=new r(t,e,this.config.bulletSpeed*.6,1,!1);this.bullets.push(s),this.bullets.push(s)}createTrackingBullet(t,e,s){const i=new r(t,e,this.config.bulletSpeed*.8,this.config.bulletDamage,!0,"tracking");i.setTarget(s),this.bullets.push(i)}createSpreadBullet(t,e){const s=[-.3,0,.3];for(const i of s){const h=new r(t,e,this.config.bulletSpeed*.9,this.config.bulletDamage,!0,"spread");h.vx=Math.sin(i)*h.speed,this.bullets.push(h)}}createLaserBullet(t,e){const s=new r(t,e,this.config.bulletSpeed*1.2,this.config.bulletDamage*2,!0,"laser");this.bullets.push(s)}updateTrackingTargets(t){const e=this.bullets.filter(s=>s.isPlayer&&s.type==="tracking"&&s.active);for(const s of e){let i=null,h=1/0;for(const n of t){if(!n.active)continue;const l=Math.abs(n.x-s.x);l<h&&(h=l,i=n)}i&&s.setTarget(i.x)}}update(t){for(const e of this.bullets)e.active&&(e.update(t),e.isOutOfBounds(this.config.canvasHeight)&&(e.active=!1));this.bullets=this.bullets.filter(e=>e.active)}render(t){for(const e of this.bullets)e.render(t)}getPlayerBullets(){return this.bullets.filter(t=>t.isPlayer)}getEnemyBullets(){return this.bullets.filter(t=>!t.isPlayer)}clear(){this.bullets=[]}}const f={normal:{width:30,height:30,health:1,speed:2,score:10,color:"#e74c3c"},fast:{width:25,height:25,health:1,speed:4,score:20,color:"#9b59b6"},heavy:{width:45,height:45,health:3,speed:1,score:30,color:"#8e44ad"},boss:{width:80,height:80,health:20,speed:1.5,score:500,color:"#c0392b"},elite:{width:35,height:35,health:3,speed:5,score:50,color:"#e67e22"},shielded:{width:40,height:40,health:2,speed:2,score:40,color:"#3498db"},bomber:{width:50,height:50,health:2,speed:1,score:60,color:"#7f8c8d"}};class C{constructor(t,e,s,i,h){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"health");a(this,"maxHealth");a(this,"speed");a(this,"score");a(this,"type");a(this,"active",!0);a(this,"shootCooldown",0);a(this,"shootInterval",0);a(this,"config");const n=f[s];this.x=t,this.y=e,this.type=s,this.width=n.width,this.height=n.height,this.maxHealth=n.health,this.health=n.health,this.speed=n.speed*((h==null?void 0:h.enemySpeed)??1),this.score=n.score,this.config=i,this.shootInterval=s==="boss"?1500:g(2e3,4e3)}update(t){this.active&&(this.y+=this.speed*(t/16),this.shootCooldown>0&&(this.shootCooldown-=t))}canShoot(){return this.active&&this.shootCooldown<=0}startShooting(){this.shootCooldown=this.shootInterval}takeDamage(t){this.health-=t,this.health<0&&(this.health=0)}isDestroyed(){return this.health<=0}destroy(){this.active=!1}isOutOfBounds(){return this.y>this.config.canvasHeight+this.height}getRect(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}checkCollision(t){return d(this.getRect(),t.getRect())}render(t){if(!this.active)return;const e=f[this.type];switch(t.fillStyle=e.color,this.type){case"normal":this.drawNormalEnemy(t);break;case"fast":this.drawFastEnemy(t);break;case"heavy":this.drawHeavyEnemy(t);break;case"boss":this.drawBossEnemy(t);break;case"elite":this.drawEliteEnemy(t);break;case"shielded":this.drawShieldedEnemy(t);break;case"bomber":this.drawBomberEnemy(t);break}this.drawHealthBar(t)}drawNormalEnemy(t){t.beginPath(),t.moveTo(this.x-this.width/2,this.y-this.height/2),t.lineTo(this.x+this.width/2,this.y-this.height/2),t.lineTo(this.x,this.y+this.height/2),t.closePath(),t.fill()}drawFastEnemy(t){t.beginPath(),t.moveTo(this.x,this.y-this.height/2),t.lineTo(this.x+this.width/2,this.y),t.lineTo(this.x,this.y+this.height/2),t.lineTo(this.x-this.width/2,this.y),t.closePath(),t.fill()}drawHeavyEnemy(t){t.beginPath();for(let e=0;e<6;e++){const s=Math.PI/3*e-Math.PI/2,i=this.x+this.width/2*Math.cos(s),h=this.y+this.height/2*Math.sin(s);e===0?t.moveTo(i,h):t.lineTo(i,h)}t.closePath(),t.fill()}drawBossEnemy(t){t.beginPath(),t.moveTo(this.x-this.width/2,this.y-this.height/2),t.lineTo(this.x+this.width/2,this.y-this.height/2),t.lineTo(this.x,this.y+this.height/2),t.closePath(),t.fill(),t.fillStyle="#ffffff",t.beginPath(),t.arc(this.x-15,this.y,8,0,Math.PI*2),t.arc(this.x+15,this.y,8,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(this.x-15,this.y,4,0,Math.PI*2),t.arc(this.x+15,this.y,4,0,Math.PI*2),t.fill()}drawEliteEnemy(t){t.beginPath(),t.moveTo(this.x-this.width/2,this.y-this.height/2),t.lineTo(this.x+this.width/2,this.y-this.height/2),t.lineTo(this.x,this.y+this.height/2),t.closePath(),t.fill(),t.strokeStyle="#e74c3c",t.lineWidth=3,t.beginPath(),t.arc(this.x,this.y,this.width/2+5,0,Math.PI*2),t.stroke(),t.lineWidth=1}drawShieldedEnemy(t){t.beginPath(),t.arc(this.x,this.y,this.width/2,0,Math.PI*2),t.fill(),t.strokeStyle="#3498db",t.lineWidth=5,t.beginPath(),t.arc(this.x,this.y,this.width/2+8,0,Math.PI*2),t.stroke(),t.lineWidth=1,t.strokeStyle="#2980b9",t.lineWidth=2,t.beginPath(),t.moveTo(this.x-10,this.y-15),t.lineTo(this.x+5,this.y),t.lineTo(this.x-5,this.y+15),t.stroke()}drawBomberEnemy(t){t.fillStyle="#7f8c8d",t.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),t.fillStyle="#e74c3c",t.font="16px Arial",t.textAlign="center",t.fillText("ðŸ’£",this.x,this.y),t.strokeStyle="#e74c3c",t.lineWidth=2,t.beginPath(),t.moveTo(this.x,this.y-this.height/2),t.lineTo(this.x,this.y-this.height/2-10),t.stroke()}drawHealthBar(t){if(this.maxHealth<=1)return;const e=this.width,s=4,i=this.x-e/2,h=this.y-this.height/2-10;t.fillStyle="#555555",t.fillRect(i,h,e,s);const n=this.health/this.maxHealth;t.fillStyle=n>.3?"#2ecc71":"#e74c3c",t.fillRect(i,h,e*n,s)}}class S{constructor(t){a(this,"enemies",[]);a(this,"config");a(this,"levelConfig");this.config=t,this.levelConfig={level:1,name:"ç¬¬ä¸€å…³",enemyCount:20,spawnInterval:1500,enemySpeed:2,bossLevel:!1}}setLevelConfig(t){this.levelConfig=t}spawn(t){const e=this.getRandomEnemyType(),s=g(50,t-50),i=-50,h=new C(s,i,e,this.config,this.levelConfig);this.enemies.push(h)}getRandomEnemyType(){const t=Math.random(),e=this.levelConfig.level;return this.levelConfig.bossLevel&&this.enemies.length===0?"boss":e===1?t<.8?"normal":"fast":e===2?t<.5?"normal":t<.8?"fast":"heavy":t<.4?"normal":t<.7?"fast":t<.85?"elite":t<.93?"shielded":"bomber"}update(t){for(const e of this.enemies)e.active&&(e.update(t),e.isOutOfBounds()&&e.destroy());this.enemies=this.enemies.filter(e=>e.active)}render(t){for(const e of this.enemies)e.render(t)}getEnemies(){return this.enemies}clear(){this.enemies=[]}}class A{constructor(t,e={}){a(this,"ctx");a(this,"config");a(this,"state","menu");a(this,"score",0);a(this,"currentLevel",1);a(this,"levelConfig");a(this,"player");a(this,"bulletManager");a(this,"enemyManager");a(this,"keys",{ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,Space:!1});a(this,"animationId",null);a(this,"lastTime",0);a(this,"accumulator",0);a(this,"fixedDeltaTime",1e3/60);a(this,"spawnTimer",0);a(this,"enemiesSpawned",0);this.ctx=t.getContext("2d"),this.config={...v,...e},this.levelConfig=c[0],this.player=new T(this.config.canvasWidth/2,this.config.canvasHeight-80,this.config),this.bulletManager=new b(this.config),this.enemyManager=new S(this.config),this.bindEvents()}bindEvents(){window.addEventListener("keydown",t=>this.handleKeyDown(t)),window.addEventListener("keyup",t=>this.handleKeyUp(t))}handleKeyDown(t){t.code==="ArrowUp"&&(this.keys.ArrowUp=!0),t.code==="ArrowDown"&&(this.keys.ArrowDown=!0),t.code==="ArrowLeft"&&(this.keys.ArrowLeft=!0),t.code==="ArrowRight"&&(this.keys.ArrowRight=!0),t.code==="Space"&&(this.keys.Space=!0),this.state==="menu"&&t.code==="Space"&&this.startGame(),this.state==="gameOver"&&t.code==="Space"&&this.restartGame(),this.state==="levelComplete"&&t.code==="Space"&&this.nextLevel(),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(t.code)&&t.preventDefault()}handleKeyUp(t){t.code==="ArrowUp"&&(this.keys.ArrowUp=!1),t.code==="ArrowDown"&&(this.keys.ArrowDown=!1),t.code==="ArrowLeft"&&(this.keys.ArrowLeft=!1),t.code==="ArrowRight"&&(this.keys.ArrowRight=!1),t.code==="Space"&&(this.keys.Space=!1)}startGame(){this.state="playing",this.score=0,this.currentLevel=1,this.loadLevel(1),this.startLoop()}restartGame(){this.player.reset(this.config.canvasWidth/2,this.config.canvasHeight-80),this.bulletManager.clear(),this.enemyManager.clear(),this.startGame()}nextLevel(){this.currentLevel<c.length?(this.currentLevel++,this.loadLevel(this.currentLevel),this.state="playing"):this.state="gameOver"}loadLevel(t){this.levelConfig=c[t-1],this.spawnTimer=0,this.enemiesSpawned=0,this.enemyManager.setLevelConfig(this.levelConfig),this.player.reset(this.config.canvasWidth/2,this.config.canvasHeight-80)}startLoop(){this.animationId!==null&&cancelAnimationFrame(this.animationId),this.lastTime=performance.now(),this.loop(this.lastTime)}loop(t){const e=t-this.lastTime;for(this.lastTime=t,this.accumulator+=e;this.accumulator>=this.fixedDeltaTime;)this.update(this.fixedDeltaTime),this.accumulator-=this.fixedDeltaTime;this.render(),this.animationId=requestAnimationFrame(s=>this.loop(s))}update(t){this.state==="playing"&&(this.updatePlayer(t),this.player.update(t),this.bulletManager.update(t),this.enemyManager.update(t),this.updateSpawning(t),this.updateEnemyShooting(),this.checkCollisions(),this.checkGameState())}updatePlayer(t){let e=0,s=0;const i=this.config.playerSpeed;this.keys.ArrowUp&&(s-=i),this.keys.ArrowDown&&(s+=i),this.keys.ArrowLeft&&(e-=i),this.keys.ArrowRight&&(e+=i);const h=this.player.x+e,n=this.player.y+s;this.player.x=u(h,this.player.width/2,this.config.canvasWidth-this.player.width/2),this.player.y=u(n,this.player.height/2,this.config.canvasHeight-this.player.height/2),this.player.shoot(this.bulletManager)}updateSpawning(t){this.enemiesSpawned>=this.levelConfig.enemyCount||(this.spawnTimer+=t,this.spawnTimer>=this.levelConfig.spawnInterval&&(this.spawnTimer=0,this.enemyManager.spawn(this.config.canvasWidth),this.enemiesSpawned++))}updateEnemyShooting(){const t=this.enemyManager.getEnemies();for(const e of t)e.active&&e.canShoot()&&(this.bulletManager.createEnemyBullet(e.x,e.y+e.height/2),e.startShooting(),y.play("enemyShoot"))}checkCollisions(){const t=this.bulletManager.getPlayerBullets(),e=this.enemyManager.getEnemies();for(const i of t)for(const h of e)i.active&&h.active&&i.checkCollision(h)&&(i.active=!1,h.takeDamage(i.damage),h.isDestroyed()&&(h.destroy(),this.score+=h.score));const s=this.bulletManager.getEnemyBullets();for(const i of s)i.active&&i.checkCollision(this.player)&&(i.active=!1,this.player.takeDamage(i.damage));for(const i of e)i.active&&i.checkCollision(this.player)&&(i.destroy(),this.player.takeDamage(1))}checkGameState(){this.player.isDestroyed()&&(this.state="gameOver"),this.enemiesSpawned>=this.levelConfig.enemyCount&&this.enemyManager.getEnemies().length===0&&(this.state="levelComplete")}render(){switch(this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(0,0,this.config.canvasWidth,this.config.canvasHeight),this.state){case"menu":this.renderMenu();break;case"playing":this.renderGame(),this.renderUI();break;case"levelComplete":this.renderGame(),this.renderUI(),this.renderLevelComplete();break;case"gameOver":this.renderGame(),this.renderUI(),this.renderGameOver();break}}renderGame(){this.enemyManager.render(this.ctx),this.bulletManager.render(this.ctx),this.player.render(this.ctx)}renderUI(){this.ctx.fillStyle="#ffffff",this.ctx.font="16px Arial",this.ctx.textAlign="left",this.ctx.fillText(`åˆ†æ•°: ${this.score}`,10,25),this.ctx.fillText(`ç”Ÿå‘½: ${this.player.health}`,10,50),this.ctx.fillText(`å…³å¡: ${this.currentLevel}/3`,10,75)}renderMenu(){this.ctx.fillStyle="#ffffff",this.ctx.font="36px Arial",this.ctx.textAlign="center",this.ctx.fillText("é£žæœºå¤§æˆ˜",this.config.canvasWidth/2,this.config.canvasHeight/2-50),this.ctx.font="20px Arial",this.ctx.fillText("æŒ‰ç©ºæ ¼é”®å¼€å§‹",this.config.canvasWidth/2,this.config.canvasHeight/2+20),this.ctx.font="14px Arial",this.ctx.fillStyle="#888888",this.ctx.fillText("æ–¹å‘é”®ç§»åŠ¨ï¼Œç©ºæ ¼é”®å°„å‡»",this.config.canvasWidth/2,this.config.canvasHeight/2+60)}renderLevelComplete(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.config.canvasWidth,this.config.canvasHeight),this.ctx.fillStyle="#00ff00",this.ctx.font="36px Arial",this.ctx.textAlign="center",this.ctx.fillText("å…³å¡å®Œæˆ!",this.config.canvasWidth/2,this.config.canvasHeight/2-30),this.ctx.fillStyle="#ffffff",this.ctx.font="20px Arial",this.ctx.fillText(`å¾—åˆ†: ${this.score}`,this.config.canvasWidth/2,this.config.canvasHeight/2+20),this.ctx.font="16px Arial",this.ctx.fillText("æŒ‰ç©ºæ ¼é”®è¿›å…¥ä¸‹ä¸€å…³",this.config.canvasWidth/2,this.config.canvasHeight/2+60)}renderGameOver(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.config.canvasWidth,this.config.canvasHeight),this.ctx.fillStyle="#ff0000",this.ctx.font="36px Arial",this.ctx.textAlign="center",this.ctx.fillText("æ¸¸æˆç»“æŸ",this.config.canvasWidth/2,this.config.canvasHeight/2-30),this.ctx.fillStyle="#ffffff",this.ctx.font="20px Arial",this.ctx.fillText(`æœ€ç»ˆå¾—åˆ†: ${this.score}`,this.config.canvasWidth/2,this.config.canvasHeight/2+20),this.currentLevel>=3&&(this.ctx.fillStyle="#ffd700",this.ctx.fillText("æ­å–œé€šå…³!",this.config.canvasWidth/2,this.config.canvasHeight/2+50)),this.ctx.font="16px Arial",this.ctx.fillStyle="#888888",this.ctx.fillText("æŒ‰ç©ºæ ¼é”®é‡æ–°å¼€å§‹",this.config.canvasWidth/2,this.config.canvasHeight/2+90)}destroy(){this.animationId!==null&&cancelAnimationFrame(this.animationId)}}const m=document.getElementById("game-canvas");if(!m)throw new Error("æ‰¾ä¸åˆ°æ¸¸æˆ Canvas å…ƒç´ ");const k=new A(m);window.addEventListener("beforeunload",()=>{k.destroy()});
//# sourceMappingURL=index-BSsb6JBU.js.map
